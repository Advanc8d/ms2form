/*
 MIT License (c) copyright 2011-2013 original author or authors */
(function(n,A){n(function(p){function c(a,b,d,e){return(a instanceof l?a:q(a)).then(b,d,e)}function l(a,b){this._message=a;this.inspect=b}function q(a){return r(function(b){b(a)})}function r(a){return n(a,s.PromiseStatus&&s.PromiseStatus())}function n(a,b){function d(a){if(u){var d=u;u=h;w(function(){c=Q(f,a);b&&R(c,b);B(d,c)})}}function e(a){d(t(a))}function g(a){if(u){var b=u;w(function(){B(b,S(a))})}}var f,c,u=[];f=new l(function(a,b,d,e){function f(c){c._message(a,b,d,e)}u?u.push(f):w(function(){f(c)})},
function(){return c?c.inspect():{state:"pending"}});f._status=b;try{a(d,e,g)}catch(T){e(T)}return f}function B(a,b){for(var d=0;d<a.length;d++)a[d](b)}function U(a){return E(new F(a),function(){return G(a)})}function t(a){return E(new H(a),function(){return I(a)})}function E(a,b){return new l(function(b,e,c){try{c(a[b].apply(a,e))}catch(f){c(t(f))}},b)}function S(a){return new l(function(b,d,e,c){b=d[2];try{c("function"===typeof b?b(a):a)}catch(f){c(f)}})}function Q(a,b){if(b===a)return t(new TypeError);
if(b instanceof l)return b;try{var d=b===Object(b)&&b.then;return"function"===typeof d?V(d,b):U(b)}catch(e){return t(e)}}function V(a,b){return r(function(d,e){C(a,b,d,e)})}function F(a){this.value=a}function H(a){this.reason=a}function R(a,b){a.then(function(){b.fulfilled()},function(a){b.rejected(a)})}function J(a){return a&&"function"===typeof a.then}function K(a,b,d,e,g){return c(a,function(a){return r(function(d,e,g){function h(a){r(a)}function p(a){q(a)}var m,n,l,t,q,r,s,k;s=a.length>>>0;m=
Math.max(0,Math.min(b,s));l=[];n=s-m+1;t=[];if(m)for(r=function(a){t.push(a);--n||(q=r=x,e(t))},q=function(a){l.push(a);--m||(q=r=x,d(l))},k=0;k<s;++k)k in a&&c(a[k],p,h,g);else d(l)}).then(d,e,g)})}function L(a,b,d,e){return y(a,x).then(b,d,e)}function y(a,b,d){return c(a,function(a){return n(function(g,f,P){function u(a,e){c(a,b,d).then(function(a){h[e]=a;--k||g(h)},f,P)}var h,l,k,m;k=l=a.length>>>0;h=[];if(k)for(m=0;m<l;m++)m in a?u(a[m],m):--k;else g(h)})})}function G(a){return{state:"fulfilled",
value:a}}function I(a){return{state:"rejected",reason:a}}function w(a){1===z.push(a)&&k(M)}function M(){B(z);z=[]}function x(a){return a}function W(a){"function"===typeof s.reportUnhandled?s.reportUnhandled():w(function(){throw a;});throw a;}c.promise=r;c.resolve=q;c.reject=function(a){return c(a,t)};c.defer=function(){var a,b,d;a={promise:h,resolve:h,reject:h,notify:h,resolver:{resolve:h,reject:h,notify:h}};a.promise=b=r(function(e,c,f){a.resolve=a.resolver.resolve=function(a){if(d)return q(a);d=
!0;e(a);return b};a.reject=a.resolver.reject=function(a){if(d)return q(t(a));d=!0;c(a);return b};a.notify=a.resolver.notify=function(a){f(a);return a}});return a};c.join=function(){return y(arguments,x)};c.all=L;c.map=function(a,b){return y(a,b)};c.reduce=function(a,b){var d=C(D,arguments,1);return c(a,function(a){var g;g=a.length;d[0]=function(a,d,e){return c(a,function(a){return c(d,function(d){return b(a,d,e,g)})})};return N.apply(a,d)})};c.settle=function(a){return y(a,G,I)};c.any=function(a,
b,d,c){return K(a,1,function(a){return b?b(a[0]):a[0]},d,c)};c.some=K;c.isPromise=J;c.isPromiseLike=J;l.prototype={then:function(a,b,d){var c,g;c=arguments;g=this._message;return n(function(a,b,d){g("when",c,a,d)},this._status&&this._status.observed())},otherwise:function(a){return this.then(h,a)},ensure:function(a){function b(){return q(a())}return"function"===typeof a?this.then(b,b).yield(this):this},done:function(a,b){this.then(a,b).otherwise(W)},yield:function(a){return this.then(function(){return a})},
tap:function(a){return this.then(a).yield(this)},spread:function(a){return this.then(function(b){return L(b,function(b){return a.apply(h,b)})})},always:function(a,b){return this.then(a,a,b)}};F.prototype.when=function(a){return"function"===typeof a?a(this.value):this.value};H.prototype.when=function(a,b){if("function"===typeof b)return b(this.reason);throw this.reason;};var N,D,C,k,z,O,v,s,h;z=[];O=A.setTimeout;s="undefined"!==typeof console?console:c;if("object"===typeof process&&process.nextTick)k=
process.nextTick;else if(v=A.MutationObserver||A.WebKitMutationObserver)k=function(a,b,d){var c=a.createElement("div");(new b(d)).observe(c,{attributes:!0});return function(){c.setAttribute("x","x")}}(document,v,M);else try{k=p("vertx").runOnLoop||p("vertx").runOnContext}catch(X){k=function(a){O(a,0)}}p=Function.prototype;v=p.call;C=p.bind?v.bind(v):function(a,b){return a.apply(b,D.call(arguments,2))};p=[];D=p.slice;N=p.reduce||function(a){var b,d,c,g,f;f=0;b=Object(this);g=b.length>>>0;d=arguments;
if(1>=d.length)for(;;){if(f in b){c=b[f++];break}if(++f>=g)throw new TypeError;}else c=d[1];for(;f<g;++f)f in b&&(c=a(c,b[f],f,b));return c};return c})})("function"===typeof define&&define.amd?define:function(n){module.exports=n(require)},this);
